/*
  leaflet tiles extent manager
  https://github.com/adammertel/Leaflet.TilesExtentManager
  Adam Mertel | univie
*/
L.Map.include({createTilesExtentControlGroup:function(i,t){for(var s in this.options.padding=.2,L.setOptions(this,t),this.tilesGroup=i,this.tilesGroup){var e=this.tilesGroup[s];e.layer.setZIndex(this.tilesGroup.length-s),e.originalBounds=e.layer.originalBounds,e.displayed=!1,e.willdisplay=!1,e.transparent=e.transparent||!1,e.bounds=e.bounds||e.layer.bounds||!1}var n=this;this.on("moveend",function(){n._refreshTilesGroup()}),this._refreshTilesGroup()},_pointInsidePoints:function(i,t){for(var s=i.lat,e=i.lng,n=!1,r=0,o=t.length-1;r<t.length;o=r++){var l=t[r].lat,a=t[r].lng,p=t[o].lat,d=t[o].lng;e<a!=e<d&&s<(p-l)*(e-a)/(d-a)+l&&(n=!n)}return n},_boundsVisible:function(i,t){var s=!1;for(var e in t){var n=t[e];if(i.contains(n)){s=!0;break}}if(!s){var r=[],o=[i.getCenter(),i.getSouthWest(),i.getNorthEast(),i.getNorthWest(),i.getSouthEast()];for(var l in o)r[l]=this._pointInsidePoints(o[l],t);s=-1!=r.indexOf(!0)&&-1!=r.indexOf(!1)}return s},_layerVisible:function(i,t){return this._pointInsidePoints(i.getCenter(),t.getLatLngs()[0])},_isLayerWithinZoom:function(i){var t=parseInt(i.layer.options.minZoom||1),s=parseInt(i.layer.options.maxZoom||40),e=parseInt(this._zoom);return!(e<t||s<e)},_refreshTilesGroup:function(){var i,t,s=this.getBounds().pad(this.options.padding);for(i in this.tilesGroup)this.tilesGroup[i].willdisplay=!1;for(i in this.tilesGroup)if(t=this.tilesGroup[i],this._isLayerWithinZoom(t))if(t.bounds){if(s.intersects(t.bounds.getBounds())){var e=this._boundsVisible(s,t.bounds.getLatLngs()[0]),n=!1;if(e||(n=this._layerVisible(s,t.bounds)),n||e)if(t.willdisplay=!0,t.transparent)t.willdisplay=!0;else if(!e)break}}else if(t.willdisplay=!0,!t.transparent)break;for(i in this.tilesGroup)(t=this.tilesGroup[i]).willdisplay!=t.display&&(t.willdisplay?(console.log(i),t.layer.addTo(this)):t.layer.removeFrom(this)),t.displayed=t.willdisplay}});